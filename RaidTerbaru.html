<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <?!= include('Style'); ?>
</head>
<body class="flex">
  <?!= include('Sidebar'); ?>

  <main class="ml-64 flex-1 p-8 overflow-y-auto">
    <header class="mb-8">
      <h1 class="font-title text-5xl font-bold text-white">Performa Raid</h1>
      <p class="text-lg text-gray-400">Papan peringkat penjarah klan di Raid Weekend terakhir.</p>
    </header>

    <div id="loading-container" class="flex justify-center items-center py-16">
      <div class="loader"></div>
    </div>
    
    <div id="content-container" class="hidden grid grid-cols-1 lg:grid-cols-2 gap-8">
       <!-- Konten akan diisi oleh JavaScript -->
    </div>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      google.script.run
        .withSuccessHandler(renderRaids)
        .withFailureHandler(showError)
        .getRaidTerbaruData();
    });

    function renderRaids(data) {
      const container = document.getElementById('content-container');
      let contentHtml = '';

      if (data.crew && data.crew.members.length > 0) {
        contentHtml += createRaidCard(data.crew, 'GBK Crew');
      }
      if (data.squad && data.squad.members.length > 0) {
        contentHtml += createRaidCard(data.squad, 'GBK Squad');
      }

      container.innerHTML = contentHtml;
      document.getElementById('loading-container').style.display = 'none';
      container.classList.remove('hidden');
    }

    function createRaidCard(raidData, clanName) {
      let tableRows = raidData.members.map(m => `
        <tr>
          <td class="text-center">${m.rank}</td>
          <td>${m.name}</td>
          <td class="text-right">${Number(m.loot).toLocaleString('id-ID')}</td>
          <td class="text-center">${m.attacks}</td>
        </tr>`).join('');

      return `
        <div class="card overflow-hidden">
          <div class="card-header"><h2 class="font-title text-xl text-white">${raidData.title}</h2></div>
          <div class="p-2">
            <div class="overflow-auto max-h-[70vh]">
              <table class="data-table">
                <thead>
                  <tr>
                    <th class="text-center">#</th>
                    <th>Nama</th>
                    <th class="text-right">Total Jarahan</th>
                    <th class="text-center">Serangan</th>
                  </tr>
                </thead>
                <tbody>${tableRows}</tbody>
              </table>
            </div>
          </div>
        </div>`;
    }

    function showError(error) {
      document.getElementById('loading-container').innerHTML = `<p class="text-red-400 font-bold">${error.message}</p>`;
    }
  </script>
</body>
</html>
