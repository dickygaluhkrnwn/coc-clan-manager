<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <?!= include('Style'); ?>
</head>
<body class="flex">
  <?!= include('Sidebar'); ?>

  <!-- Konten Utama dengan margin kiri -->
  <main class="ml-64 flex-1 p-8 overflow-y-auto">
    <header class="mb-8">
      <h1 class="font-title text-5xl font-bold text-white">Anggota Klan</h1>
      <p class="text-lg text-gray-400">Database seluruh anggota di klan GBK.</p>
    </header>

    <div id="loading-container" class="flex justify-center items-center py-16">
      <div class="loader"></div>
    </div>
    
    <div id="table-container" class="hidden card p-4 overflow-hidden">
      <div class="overflow-auto max-h-[75vh]">
        <table class="data-table">
          <thead>
            <tr>
              <th>Nama</th>
              <th>TH</th>
              <th>Role</th>
              <th>Klan</th>
              <th>Donasi</th>
              <th>Liga</th>
            </tr>
          </thead>
          <tbody id="anggota-tbody">
            <!-- Data akan diisi oleh JavaScript -->
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <script>
    let allMembers = [];

    document.addEventListener("DOMContentLoaded", function() {
      google.script.run
        .withSuccessHandler(populateTable)
        .withFailureHandler(showError)
        .getAnggotaData();
      
      document.getElementById('searchInput').addEventListener('keyup', filterTable);
    });

    function populateTable(members) {
      allMembers = members;
      displayMembers(allMembers);
      document.getElementById('loading-container').style.display = 'none';
      document.getElementById('content-container').classList.remove('hidden');
    }
    
    function displayMembers(members) {
        const tableBody = document.getElementById('anggota-table-body');
        let html = '';
        members.forEach(m => {
          html += `<tr>
            <td>${m.namaKlan}</td>
            <td>${m.nama}</td>
            <td>${m.role}</td>
            <td>${m.th}</td>
            <td>${m.donasi}</td>
            <td>${m.donasiDiterima}</td>
            <td>${m.xp}</td>
            <td>${m.liga}</td>
          </tr>`;
        });
        tableBody.innerHTML = html;
    }
    
    function filterTable() {
        const query = document.getElementById('searchInput').value.toLowerCase();
        const filteredMembers = allMembers.filter(member => {
            return member.nama.toLowerCase().includes(query);
        });
        displayMembers(filteredMembers);
    }

    function showError(error) {
      document.getElementById('loading-container').innerHTML = `<p class="text-red-400 font-bold">${error.message}</p>`;
    }
  </script>
</body>
</html>

